<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Economics Routine World 3-2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=DotGothic16&display=swap" rel="stylesheet">
    <style>
        :root {
            --sky-blue: #70a1ff;
            --mario-gold: #ffda79;
            --emerald: #26de81;
            --azure: #45aaf2;
            --night-bg: #2f3542;
            --hud-bg: rgba(0, 0, 0, 0.9);
        }

        body {
            font-family: 'Press+Start+2P', cursive;
            background-color: var(--sky-blue);
            color: white;
            image-rendering: pixelated;
            margin: 0;
            padding: 10px;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Responsive HUD */
        .hud {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 1150px;
            margin: 0 auto 20px auto;
            text-shadow: 2px 2px 0px #000;
            font-size: 10px;
            background: var(--hud-bg);
            padding: 12px;
            border: 4px solid #000;
            position: relative;
            z-index: 100;
        }

        @media (min-width: 768px) {
            .hud {
                grid-template-columns: repeat(4, 1fr);
                font-size: 12px;
                text-align: center;
            }
        }

        .nes-container {
            border: 6px solid black;
            background: #f1f2f6;
            box-shadow: 6px 6px 0px rgba(0,0,0,0.3);
            padding: 0;
            position: relative;
            margin-bottom: 30px;
            width: 100%;
        }

        .pixel-btn {
            font-family: 'Press+Start+2P', cursive;
            background: var(--mario-gold);
            border: 4px solid black;
            padding: 10px 12px;
            color: black;
            cursor: pointer;
            box-shadow: 4px 4px 0px black;
            font-size: 9px;
            transition: all 0.1s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        @media (min-width: 768px) {
            .pixel-btn { font-size: 10px; padding: 12px 16px; }
        }

        .pixel-btn:hover { background: #ffeaa7; }
        .pixel-btn:active {
            box-shadow: 0px 0px 0px black;
            transform: translate(4px, 4px);
        }

        .pixel-btn.active { background: var(--emerald); color: white; }

        /* Table Responsiveness */
        .table-scroll-container {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .scroll-hint {
            display: block;
            text-align: center;
            font-size: 8px;
            color: black;
            padding: 5px;
            background: #dfe4ea;
            border-bottom: 2px solid black;
        }

        @media (min-width: 1024px) { .scroll-hint { display: none; } }

        table { width: 100%; min-width: 800px; border-collapse: collapse; background: white; table-layout: fixed; }
        th { background: #2f3542; color: white; border: 4px solid black; padding: 10px 5px; font-size: 11px; }
        td { border: 4px solid black; padding: 0; height: 110px; position: relative; }

        .cell-wrapper { 
            width: 100%; height: 100%; 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            padding: 4px; text-align: center; 
        }

        .time-cell { background: #2f3542; font-size: 11px; color: var(--mario-gold); }

        .section-a { background: var(--emerald); color: #000; }
        .section-b { background: var(--azure); color: #fff; }
        .optional { background: var(--mario-gold); color: #000; }
        .no-class { background: #dfe4ea; color: #a4b0be; font-size: 10px; }

        /* Generator Styles */
        #page-generator {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #f1f2f6;
            z-index: 2000;
            display: none;
            flex-direction: column;
            color: black;
            overflow-y: auto;
        }

        .generator-header {
            background: #2f3542;
            color: white;
            padding: 15px;
            border-bottom: 6px solid black;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        /* Fallback Viewport for Messenger */
        #mobile-save-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 3000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        #result-image-preview {
            max-width: 100%;
            max-height: 70vh;
            border: 4px solid white;
            margin-bottom: 20px;
        }

        .ground { position: fixed; bottom: 0; left: 0; width: 100%; height: 20px; background: #ffa502; border-top: 4px solid black; z-index: 50; }
        
        canvas#export-canvas { display: none; }
    </style>
</head>
<body class="flex flex-col items-center">

    <!-- Mobile Save Overlay (Fix for Messenger/FB browser) -->
    <div id="mobile-save-overlay">
        <h2 class="text-white text-xs mb-4">IMAGE GENERATED!</h2>
        <img id="result-image-preview" src="" alt="Routine Preview">
        <p class="text-yellow-400 text-[10px] mb-6">LONG-PRESS (HOLD) THE IMAGE ABOVE<br>AND SELECT "SAVE IMAGE" OR "DOWNLOAD"</p>
        <button onclick="closeOverlay()" class="pixel-btn" style="background:#ff4757; color:white;">BACK TO GENERATOR</button>
    </div>

    <div class="hud">
        <div>HHA<br/>001700</div>
        <div>COIN<br/><div style="display:inline-block; width:10px; height:10px; background:var(--mario-gold); border:2px solid black;"></div> x 17</div>
        <div>LVL<br/>3-2</div>
        <div id="hud-mode">ROUTINE<br/>FULL</div>
    </div>

    <div id="view-main" class="w-full flex flex-col items-center">
        <header class="text-center mb-6 px-4">
            <h1 class="mb-4 text-xl md:text-3xl" style="text-shadow: 3px 3px 0 black;">ROUTINE WORLD</h1>
            <div class="flex gap-2 flex-wrap justify-center">
                <button onclick="switchMode('Full')" id="btn-Full" class="pixel-btn active">FULL</button>
                <button onclick="switchMode('A')" id="btn-A" class="pixel-btn">SEC A</button>
                <button onclick="switchMode('B')" id="btn-B" class="pixel-btn">SEC B</button>
                <button onclick="switchMode('Opt')" id="btn-Opt" class="pixel-btn">OPT</button>
            </div>
        </header>

        <div class="nes-container max-w-6xl">
            <div class="scroll-hint">◀ SWIPE TO VIEW FULL SCHEDULE ▶</div>
            <div class="table-scroll-container">
                <table id="main-table">
                    <thead>
                        <tr>
                            <th style="width: 100px;">TIME</th>
                            <th>SUN</th>
                            <th>MON</th>
                            <th>TUE</th>
                            <th>WED</th>
                            <th>THU</th>
                        </tr>
                    </thead>
                    <tbody id="routine-body"></tbody>
                </table>
            </div>
        </div>

        <div class="px-4 w-full flex justify-center">
            <button onclick="toggleGenerator(true)" class="pixel-btn bg-red-500 text-white text-sm p-5 mt-4 mb-20 w-full md:w-auto shadow-[6px_6px_0_black]">
                [!] GENERATE & DOWNLOAD ROUTINE
            </button>
        </div>
    </div>

    <!-- Generator Interface -->
    <div id="page-generator">
        <div class="generator-header">
            <h2 class="text-xs">ROUTINE GENERATOR</h2>
            <button onclick="toggleGenerator(false)" class="pixel-btn" style="background: #ff4757; color:white; padding: 5px 8px; font-size:8px;">CLOSE [X]</button>
        </div>

        <div class="p-4 max-w-4xl mx-auto w-full">
            <div class="bg-white border-4 border-black p-4 shadow-[6px_6px_0_black] text-black">
                <div class="mb-6">
                    <label class="block font-bold mb-2 uppercase text-[10px]">1. Select Section</label>
                    <div class="flex gap-2">
                        <button onclick="setGenParam('section', 'A')" id="gen-sec-A" class="pixel-btn active flex-1">SEC A</button>
                        <button onclick="setGenParam('section', 'B')" id="gen-sec-B" class="pixel-btn flex-1">SEC B</button>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block font-bold mb-2 uppercase text-[10px]">2. Select Optional</label>
                    <select id="gen-opt-select" onchange="setGenParam('optional', this.value)" class="w-full p-3 border-4 border-black font-mono text-xs bg-white">
                        <option value="307_O">307 - Population Science</option>
                        <option value="311_O">311 - Health Economics</option>
                        <option value="312_O">312 - Data Science</option>
                        <option value="313_O">313 - Agricultural Economics</option>
                    </select>
                </div>

                <div class="bg-gray-200 p-3 border-2 border-black text-center mb-6">
                    <p class="text-[9px] uppercase">Preview: <span id="preview-info" class="font-bold">SECTION A + POPULATION</span></p>
                </div>

                <button id="main-download-btn" onclick="drawAndDownload()" class="pixel-btn active w-full py-5 text-xs" style="background:#2ecc71;">
                    GENERATE IMAGE
                </button>
                <p class="text-[8px] text-center mt-3 text-gray-500 uppercase">Will open in a viewer for easy saving</p>
            </div>
        </div>
    </div>

    <canvas id="export-canvas" width="2000" height="1800"></canvas>
    <div class="ground"></div>

    <script>
        const courseDetails = {
            "302_A": { code: "302(A)", short: "Econometrics", name: "Econometrics II", prof: "S. M Abdullah", room: "301" },
            "302_B": { code: "302(B)", short: "Econometrics", name: "Econometrics II", prof: "S. M Abdullah", room: "302/301" },
            "304_A": { code: "304(A)", short: "Dyn Opt", name: "Dynamic Optimization", prof: "Dr. Md. Deen Islam", room: "301" },
            "304_B": { code: "304(B)", short: "Dyn Opt", name: "Dynamic Optimization", prof: "Dr. Md. Deen Islam", room: "301" },
            "308_A": { code: "308(A)", short: "Pub Eco", name: "Public Economics", prof: "Tahia Anan Dhira", room: "301/302" },
            "308_B": { code: "308(B)", short: "Pub Eco", name: "Public Economics", prof: "Tahia Anan Dhira", room: "302/301" },
            "307_O": { code: "307(O)", short: "Population", name: "Population Science", prof: "Dr. Aroni Barkat", room: "303/301" },
            "311_O": { code: "311(O)", short: "Health Eco", name: "Health Economics", prof: "Prof. Dr. Rumana Huque", room: "302/301" },
            "312_O": { code: "312(O)", short: "Data Sci", name: "Data Science", prof: "Dr. Mohaimen Mansur", room: "302" },
            "313_O": { code: "313(O)", short: "Agri Eco", name: "Agricultural Economics", prof: "Prof. Farzana Laizu", room: "302" }
        };

        const rawData = [
            { time: "08:00-09:20", sun: "302_A", mon: "304_A", tue: "302_B", wed: "311_O", thu: "307_O" },
            { time: "09:30-10:50", sun: "302_B", mon: "304_B", tue: "302_A", wed: "split_304A_308B", thu: "311_O" },
            { time: "11:00-12:20", sun: "none", mon: "none", tue: "312_O", wed: "304_B", thu: "312_O" },
            { time: "12:30-01:50", sun: "313_O", mon: "308_A", tue: "313_O", wed: "308_A", thu: "none" },
            { time: "02:00-03:20", sun: "none", mon: "308_B", tue: "none", wed: "none", thu: "none" },
            { time: "03:30-04:50", sun: "307_O", mon: "none", tue: "none", wed: "none", thu: "none" }
        ];

        let genState = { section: 'A', optional: '307_O' };

        function getCellMarkup(key, mode) {
            if (!key || key === "none") return `<div class="cell-wrapper no-class">---</div>`;
            if (key === "split_304A_308B") {
                if (mode === 'A') return getCellMarkup("304_A", mode);
                if (mode === 'B') return getCellMarkup("308_B", mode);
                return `<div class="flex h-full w-full"><div class="section-a flex-1 flex items-center justify-center border-r border-black">A</div><div class="section-b flex-1 flex items-center justify-center">B</div></div>`;
            }
            const course = courseDetails[key];
            const type = key.split('_')[1];
            const cls = type === 'O' ? 'optional' : (type === 'A' ? 'section-a' : 'section-b');
            return `<div class="cell-wrapper ${cls}"><span class="text-[10px] font-bold">${course.code}</span><span class="text-[8px] leading-tight">${course.short}</span></div>`;
        }

        function switchMode(mode) {
            document.querySelectorAll('#view-main .pixel-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
            document.getElementById('hud-mode').innerHTML = `ROUTINE<br/>${mode.toUpperCase()}`;
            const body = document.getElementById('routine-body');
            body.innerHTML = '';
            rawData.forEach(row => {
                const tr = document.createElement('tr');
                let html = `<td class="time-cell font-bold text-center">${row.time.replace('-', '<br/>')}</td>`;
                ['sun', 'mon', 'tue', 'wed', 'thu'].forEach(day => {
                    let k = row[day];
                    let visible = mode === 'Full' || (k !== 'none' && (k.includes('_'+mode) || k.includes('_O') || k === 'split_304A_308B'));
                    html += `<td>${visible ? getCellMarkup(k, mode) : getCellMarkup('none')}</td>`;
                });
                tr.innerHTML = html;
                body.appendChild(tr);
            });
        }

        function toggleGenerator(show) {
            document.getElementById('page-generator').style.display = show ? 'flex' : 'none';
            document.body.style.overflow = show ? 'hidden' : 'auto';
        }

        function setGenParam(p, v) {
            genState[p] = v;
            document.getElementById('gen-sec-A').classList.toggle('active', genState.section === 'A');
            document.getElementById('gen-sec-B').classList.toggle('active', genState.section === 'B');
            document.getElementById('preview-info').innerText = `SECTION ${genState.section} + ${courseDetails[genState.optional].short.toUpperCase()}`;
        }

        function closeOverlay() {
            document.getElementById('mobile-save-overlay').style.display = 'none';
        }

        async function drawAndDownload() {
            const btn = document.getElementById('main-download-btn');
            btn.innerText = "RENDERING...";
            btn.disabled = true;

            await document.fonts.ready;
            const canvas = document.getElementById('export-canvas');
            const ctx = canvas.getContext('2d');
            const W = 2000; const H = 1800;

            ctx.fillStyle = "#ffffff";
            ctx.fillRect(0, 0, W, H);
            ctx.strokeStyle = "#000000"; ctx.lineWidth = 20;
            ctx.strokeRect(20, 20, W-40, H-40);

            ctx.fillStyle = "#000000"; ctx.textAlign = "center";
            ctx.font = "bold 60px 'Press Start 2P'";
            ctx.fillText("ECONOMICS WORLD 3-2", W/2, 120);
            ctx.font = "30px 'Press Start 2P'";
            ctx.fillText(`SECTION ${genState.section} | ${courseDetails[genState.optional].name.toUpperCase()}`, W/2, 200);

            const startX = 100; const startY = 280;
            const colW = (W - 200) / 6;
            const rowH = (H - 450) / 7;

            const days = ["TIME", "SUN", "MON", "TUE", "WED", "THU"];
            ctx.font = "bold 28px 'Press Start 2P'";
            days.forEach((day, i) => {
                ctx.fillStyle = "#2f3542";
                ctx.fillRect(startX + i*colW, startY, colW, rowH);
                ctx.strokeRect(startX + i*colW, startY, colW, rowH);
                ctx.fillStyle = "#ffffff";
                ctx.fillText(day, startX + i*colW + colW/2, startY + rowH/2 + 10);
            });

            rawData.forEach((row, rIdx) => {
                const y = startY + (rIdx + 1) * rowH;
                ctx.fillStyle = "#2f3542";
                ctx.fillRect(startX, y, colW, rowH);
                ctx.strokeRect(startX, y, colW, rowH);
                ctx.fillStyle = "#ffda79";
                ctx.font = "bold 24px 'Press Start 2P'";
                ctx.fillText(row.time.split('-')[0], startX + colW/2, y + rowH * 0.4);
                ctx.fillText(row.time.split('-')[1], startX + colW/2, y + rowH * 0.7);

                ["sun", "mon", "tue", "wed", "thu"].forEach((day, dIdx) => {
                    const x = startX + (dIdx + 1) * colW;
                    let key = row[day];
                    if (key === "split_304A_308B") key = (genState.section === 'A') ? '304_A' : '308_B';
                    
                    let isVisible = (key !== "none" && (key.includes('_'+genState.section) || key === genState.optional));
                    
                    ctx.fillStyle = isVisible ? (key.includes('_O') ? "#ffda79" : (genState.section === 'A' ? "#26de81" : "#45aaf2")) : "#f1f2f6";
                    ctx.fillRect(x, y, colW, rowH);
                    ctx.strokeRect(x, y, colW, rowH);

                    if (isVisible) {
                        const c = courseDetails[key];
                        ctx.fillStyle = "#000000";
                        ctx.font = "bold 26px 'Press Start 2P'";
                        ctx.fillText(c.code, x + colW/2, y + rowH * 0.35);
                        ctx.font = "20px 'Press Start 2P'";
                        ctx.fillText(c.short, x + colW/2, y + rowH * 0.65);
                        ctx.font = "16px 'Press Start 2P'";
                        ctx.fillText(`R-${c.room}`, x + colW/2, y + rowH * 0.85);
                    }
                });
            });

            const dataUrl = canvas.toDataURL('image/png');
            const previewImg = document.getElementById('result-image-preview');
            previewImg.src = dataUrl;
            document.getElementById('mobile-save-overlay').style.display = 'flex';

            btn.innerText = "GENERATE IMAGE";
            btn.disabled = false;
        }

        window.onload = () => switchMode('Full');
    </script>
</body>
</html>
